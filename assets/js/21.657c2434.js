(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{359:function(a,t,s){"use strict";s.r(t);var e=s(4),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h2",{attrs:{id:"部署声明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署声明"}},[a._v("#")]),a._v(" 部署声明")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("名称")]),a._v(" "),t("th",[a._v("版本")]),a._v(" "),t("th",[a._v("IP")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Rocket")]),a._v(" "),t("td",[a._v("4.4.0")]),a._v(" "),t("td",[a._v("192.168.10.99")])])])]),a._v(" "),t("h2",{attrs:{id:"官方链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#官方链接"}},[a._v("#")]),a._v(" 官方链接")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("名称")]),a._v(" "),t("th",[a._v("地址")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("官方文档")]),a._v(" "),t("td",[t("a",{attrs:{href:"https://rocketmq.apache.org/docs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://rocketmq.apache.org/docs/"),t("OutboundLink")],1)])])])]),a._v(" "),t("h2",{attrs:{id:"安装namesrv"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装namesrv"}},[a._v("#")]),a._v(" 安装namesrv")]),a._v(" "),t("p",[t("strong",[a._v("1. 拉取镜像")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull rocketmqinc/rocketmq\n")])])]),t("p",[t("strong",[a._v("2. 创建挂载目录")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("  /docker/rocketmq/data/namesrv/logs   /docker/rocketmq/data/namesrv/store\n")])])]),t("p",[t("strong",[a._v("3. 创建和启动容器")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" rmqnamesrv "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9876")]),a._v(":9876 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /docker/rocketmq/data/namesrv/logs:/root/logs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /docker/rocketmq/data/namesrv/store:/root/store "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MAX_POSSIBLE_HEAP=100000000"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\nrocketmqinc/rocketmq "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" mqnamesrv \n")])])]),t("h2",{attrs:{id:"安装broker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装broker"}},[a._v("#")]),a._v(" 安装broker")]),a._v(" "),t("p",[t("strong",[a._v("1. 创建broker数据存储路径")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v("  /docker/rocketmq/data/broker/logs   /docker/rocketmq/data/broker/store /docker/rocketmq/conf\n")])])]),t("p",[t("strong",[a._v("2. 创建配置文件")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /docker/rocketmq/conf/broker.conf\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 所属集群名称，如果节点较多可以配置多个")]),a._v("\nbrokerClusterName "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" DefaultCluster\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#broker名称，master和slave使用相同的名称，表明他们的主从关系")]),a._v("\nbrokerName "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" broker-a\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#0表示Master，大于0表示不同的slave")]),a._v("\nbrokerId "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#表示几点做消息删除动作，默认是凌晨4点")]),a._v("\ndeleteWhen "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" 04\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#在磁盘上保留消息的时长，单位是小时")]),a._v("\nfileReservedTime "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("48")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；")]),a._v("\nbrokerRole "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ASYNC_MASTER\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；")]),a._v("\nflushDiskType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" ASYNC_FLUSH\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 设置broker节点所在服务器的ip地址")]),a._v("\nbrokerIP1 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".10.99\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("diskMaxUsedSpaceRatio")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("95")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#开启自动创建主题")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("autoCreateTopicEnable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#开启过滤消息")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("enablePropertyFilter")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n\n")])])]),t("p",[t("strong",[a._v("3. 构建broker容器")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" rmqbroker "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--link")]),a._v(" rmqnamesrv:namesrv "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10911")]),a._v(":10911 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10909")]),a._v(":10909 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("  /docker/rocketmq/data/broker/logs:/root/logs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("  /docker/rocketmq/data/broker/store:/root/store "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /docker/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"NAMESRV_ADDR=namesrv:9876"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"MAX_POSSIBLE_HEAP=200000000"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\nrocketmqinc/rocketmq "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" mqbroker "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-c")]),a._v(" /opt/rocketmq-4.4.0/conf/broker.conf \n")])])]),t("h2",{attrs:{id:"安装控制台服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装控制台服务"}},[a._v("#")]),a._v(" 安装控制台服务")]),a._v(" "),t("p",[t("strong",[a._v("1. 拉起镜像")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull pangliang/rocketmq-console-ng\n")])])]),t("p",[t("strong",[a._v("2. 构建容器")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("always "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" rmqadmin "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("\"JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.10.99:9876 \\\n-Dcom.rocketmq.sendMessageWithVIPChannel=false \\\n-Duser.timezone='Asia/Shanghai'\"")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtime:/etc/localtime "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9999")]),a._v(":8080 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\npangliang/rocketmq-console-ng\n")])])]),t("p",[a._v("控制台地址： "),t("a",{attrs:{href:"http://192.168.10.99:9999",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.10.99:9999"),t("OutboundLink")],1)]),a._v(" "),t("p",[t("img",{attrs:{src:"https://gcore.jsdelivr.net/gh/zhangchuan11/images/image-20220926233248383.png",alt:"image-20220926233248383"}})]),a._v(" "),t("h2",{attrs:{id:"控制台报错-this-date-have-t-data"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制台报错-this-date-have-t-data"}},[a._v("#")]),a._v(" 控制台报错 This date have’t data")]),a._v(" "),t("p",[a._v("构建容器时加入jvm 时区及系统时区文件")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /etc/localtime:/etc/localtime\n")])])]),t("h2",{attrs:{id:"集成boot时-code-1-desc-the-broker-does-not-support-consumer-to-filter-message-by-sql92"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集成boot时-code-1-desc-the-broker-does-not-support-consumer-to-filter-message-by-sql92"}},[a._v("#")]),a._v(" 集成boot时 CODE: 1  DESC: The broker does not support consumer to filter message by SQL92")]),a._v(" "),t("p",[a._v("在broker.conf配置文件中 #开启过滤消息功能")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("enablePropertyFilter")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])])]),t("p",[a._v('docker run -d --restart=always --name rmqadmin -e "JAVA_OPTS=-Drocketmq.namesrv.addr=b.youlai.tech:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false" -Duser.timezone=\'Asia/Shanghai\'" -v /etc/localtime:/etc/localtime -p 9999:8080 pangliang/rocketmq-console-ng')])])}),[],!1,null,null,null);t.default=r.exports}}]);